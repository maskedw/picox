<img style="display:block;margin:auto" alt="logo"
     src="https://raw.github.com/wiki/maskedw/picox/res/picox_logo.png" />
<!-- https://www.squarespace.com/logo -->

## これは何？

省メモリの組み込み環境を想定した軽量汎用ライブラリです。

----------------------------------------------------------------------
## 特徴

マイコンプログラム開発ではドライバ操作が大きなウエイトを占めていますが、ありがた
いことに昨今ではマイコンベンダが周辺機器のデバイスドライバを提供してくれているこ
とが多いです。

しかし、標準Cが提供する機能はあまりにも貧弱であり、標準Cライブラリがフルに使用で
きることさえ期待できない小規模組込み開発は相変わらず辛いものです。

そのため、このライブラリではなくても力技でなんとかなるが、あると嬉しい小粒なルー
チンを集めています。

CPUやOSの有無に極力依存しないように実装しているので、新たなターゲットにも即座に
利用可能です。

ベンダのライブラリとこのライブラリを組み合わせて、新規CPUでも手早くアプリケー
ションを構築することを目的としています。

想定ターゲットは、RAM 数KByte ~ 数MByte、ROM 数十KByte ~ 数十MByte程度の小規模
なCPUです。

----------------------------------------------------------------------
## Arduino, mbed, Raspberry Piとの比較

昨今では、Arduino, mbed, Raspberry Pi等、お手軽にプロトタイプを作れる環境が整っ
ており、簡単なプロトタイプの作成が信じられないほどお手軽になりました。

これらのプラットフォームでは、CPUごとにクセのある周辺デバイスのドライバが統一し
たインターフェースで実装済みなので、CPUの違いをあまり意識することなく、すぐにア
プリケーション開発を行えることが特徴です。

問題は、これらのプラットフォームに対応していないボードやCPUで開発を行う場合、自
力で互換部分を実装する必要があることです。
低レベル開発に熟練し、かつ英語がスラスラと読める人間でないと、困難な作業になるで
しょう。

picoxは特定のターゲットを持たず、デバイスに依存しないソフトウェアライブラリとし
ての機能が中心なので方向性が違います。

ドライバ部分を自分で用意しないとこのライブラリだけでは何もできないので、初心者用
ではなく玄人向けですが、実業務の使用にも耐えうる様、コードを吟味しています。

日本語ドキュメントのある低級なライブラリというのは、貴重だと思われるので低級プロ
グラムに興味のある組込みプログラマ初学者〜中級者の学習用途にも最適です。

----------------------------------------------------------------------
## 動作条件

+ 1バイトは8bitであること
+ バイトオーダはビッグ or リトルエンディアンであること
+ コンパイラはANSI C99に対応していること
+ CPUは16 or 32 or 64bitであること

厳密に条件を列挙するとややこしく感じますが、要するに現行のほぼ全てのCPUとコンパ
イラに当てはまると思われます。

※<br>
8bitCPUでも現行バージョンでは動作可能だと思いますが、今後の開発で明確に動作対象
外とする可能性があります。

C99はフルサポートである必要はありません。
stdint.h, stdbool.h等のtypedef定義のヘッダと、snprintf()等の一部C99ライブラリ関
数を使用しています。

### C89対応について
Renesas CA78K0R, CCRLコンパイラがC99に対応していなかったため、以下モジュールにつ
いてはC89対応済みです。

今後は使用頻度の高いものについては段階的にC89対応を行っていく予定です。

+ core
+ allocator
+ container (xintrusive_listのみ)

CA78K0R, CCRLを使用してビルドをする場合は、不足ヘッダファイルを補うために、イン
クルードパスに以下のパスを追加してください。

```
  picox/core/stdcompat/{ca78k0r | ccrl}
```

----------------------------------------------------------------------
## 依存ライブラリ

+ 標準Cライブラリ(一部C99の関数を使用)

----------------------------------------------------------------------
## ビルド方法

gitのサブモジュール機能を使用しているので、`git clone`でダウンロードした場合は、
以下のコマンドでサブモジュールの初期化を行ってください。

```sh
    cd {picox-dir}
    git submodule update --init --recursive
```

コンパイラが未使用関数の除去機能を持っている場合、picox, picox_external以下のソ
ースコードをまるごとプロジェクトに登録してビルドをするのが簡単です。
除去機能がない場合は、ライブラリサイズが肥大化しないように、必要なソースコードだ
けをプロジェクトに追加してください。
CMake用の設定ファイルも用意しているので、このファイルも参考にしてみてください。

### 未使用関数の除去機能について
gccの場合以下のオプションで未使用関数を除去できます。

```sh
  # コンパイルオプション
  gcc -ffunction-sections -fdata-sections

  # リンクオプション
  ld --gc-sections

  # リンクオプションをgccから指定する場合
  gcc -Wl,--gc-sections
```

マイコン開発のIDEの場合、デフォルトでこのオプションが指定されていることが多いよ
うです。

+ AtmelStudio(Atmel)
+ PSoCCreator(Cypress)

**除去機能がないことが確認できているコンパイラ**

+ Renesas CA78K0R 1.7.2

リソース制限のきつい組込み開発ではこの機能は必須だと思うのですが、残念ながらすべ
てのコンパイラで使用できるわけではないようです。

----------------------------------------------------------------------
## 各モジュールのリファレンス

基本的にはヘッダファイルを確認し、わからなかったらソースを読め！というスタイルで
すが、`Doxygen`で生成した
[APIドキュメント](https://maskedw.github.io/picox_apidoc/index.html)
も`GitHub Pages`にて公開しています。

----------------------------------------------------------------------
## テスト環境

このライブラリは以下の環境でテストしています。

+ MinGW 32 GCC 4.8.1
+ MSYS2 MinGW 32 GCC 4.9.2
+ MSYS2 MinGW 64 GCC 4.9.2
+ Ubuntu 14.04 GCC 4.8.4
+ Ubuntu 16.04 GCC 5.3.1
+ Renesas CCRL 1.02.00
+ Renesas CA78K0R 1.72
+ Atmel avr-gcc 4.9.2 (AtmelStudio 7)
+ Texas Instruments TI v15.12.1.LTS (Code Composer Studio v6.1)

----------------------------------------------------------------------
## 外部ライブラリ

picoxと同等のライセンス(MIT, BSD, Apache License 2.0, etc)で、有用な外部ライブラ
リは積極的に取り込んでおり、一部変更を加えて、picox_externalディレクトリにまとめ
ています。 各ライブラリのライセンスや使用方法は、それぞれのライブラリの解説を参
照してください。


+ [Unity][Unity] ユニットテストフレームワーク
+ [minIni][minIni] iniファイル操作
+ [sds][sds] 動的文字列
+ [uthash][uthash] ハッシュコンテナ を中心に各種コンテナ
+ [libfixmath][libfixmath] 16 x 16固定小数点
+ [spiffs][spiffs] ウェアレベリング機能付きSPIフラッシュ用ファイルシステム
+ [FatFs][FatFs] 組込み界隈では誰もが知る、日本産 Fatファイルシステムドライバ


[Unity]:https://github.com/ThrowTheSwitch/Unity.git
[minIni]:https://github.com/compuphase/minIni.git
[sds]:https://github.com/maskedw/sds.git
[uthash]:https://github.com/troydhanson/uthash.git
[libfixmath]:https://github.com/mhfan/libfixmath.git
[spiffs]:https://github.com/pellepl/spiffs.git
[FatFs]:http://elm-chan.org/fsw/ff/00index_j.html

----------------------------------------------------------------------
## リリースノート

### v0.1 2015/07/12
+ プロトタイプ

### v0.2 2016/01/05
+ バグ修正多数
+ 細かな機能追加
+ 独自printf追加
+ 動的文字列クラス追加
+ ストリームクラス追加

### v0.3 2016/05/04
+ バグ修正多数
+ 細かな機能追加
+ xstrモジュールの廃止(同等の関数はxstring.hで提供)
+ 各外部ライブラリのサブモジュール化
+ ファイルシステム関連の超絶強化

### v0.4 2016/06/25
+ バグ修正多数
+ 細かな機能追加
+ マルチタスクモジュール(xfiber)の実装

### Roadmap
+ v0.5 HAL(Hardware Abstraction Layer)の実装
+ v0.6 v1.0に向けた調整
